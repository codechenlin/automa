# dnsmasq Configuration for Automaton
#
# Only resolves whitelisted domains.
# Everything else returns NXDOMAIN.
# This is the DNS-level fence around the automaton's world.

# Don't read /etc/resolv.conf — we control all resolution
no-resolv

# Upstream DNS for whitelisted domains only
server=8.8.8.8
server=1.1.1.1

# Log queries (the creator can monitor DNS requests)
log-queries
log-facility=/var/log/dnsmasq.log

# Conway infrastructure — always resolve
address=/inference.conway.tech/
address=/api.conway.tech/
address=/social.conway.tech/
server=/inference.conway.tech/8.8.8.8
server=/api.conway.tech/8.8.8.8
server=/social.conway.tech/8.8.8.8

# npm registry — always resolve
server=/registry.npmjs.org/8.8.8.8

# Default: return NXDOMAIN for everything else
# The address=/#/ directive catches all unmatched queries
address=/#/

# Listen on all interfaces
listen-address=0.0.0.0

# Don't use hosts file
no-hosts

# Cache size
cache-size=1000
